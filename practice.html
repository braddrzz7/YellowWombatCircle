<html>

<head>

  <script src="util/util.js"></script>
  <script src="util/imageText.js"></script>
  <script src="qg/js/drawing.js"></script>
  <script src="qg/js/words.js"></script>
  <script src="qg/js/question.js"></script>
  <script src="qg/js/questionTypes.js"></script>
  <script src="qg/js/q-math.js"></script>
  <script src="qg/js/q-time.js"></script>
  <script src="qg/js/q-language.js"></script>
  <script src="qg/js/maker.js"></script>
  <script src="qg/js/everything.js"></script>
  <script src="qg/js/presets.js"></script>
  <script src="qg/js/presetsA.js"></script>
  <script src="qg/js/presetsB.js"></script>


  <link rel="stylesheet" type="text/css" href="qg/css/qg.css">

</head>

<body>



  <div id='menubar' class='menubar'>
    <div>View<select id='view' onchange='toggleView(filterPars)'>
      <option value='all'>all questions</option>
        <option value='presets'>preset groups</option>
        <option value='kidA'>Kid A</option>
        <option value='kidB'>Kid B</option>
        <!-- <option value='saved'>saved choices</option> -->
      </select></div>
    <button id='toggleAllQuestions' onclick='toggleAllQuestions()'>Open/Close All</button>
    <div>Max Questions <input id='numAsks' type='number' value=10 min=1 max=99></input></div>
    <!-- <div>Shuffle <input id='shuffle' type='checkbox'></input></div> -->
    <div>Format <select id='format'>
        <option value='all'>All at once</option>
        <option value='one'>One at a time</option>
      </select></div>
    <button onclick="makeEWS('new')">Make</button>
    <div>Questions Selected:&nbsp;<span id='numSelectedQ' style="width:3em;display:inline-block;">0</span></div>
  </div>

  <div id='spacer' style="margin-top:1.5cm;"></div>

  <ul id='instructions'>
    <li>Click the section headings to expand to see subsections and questions</li>
    <li>Click the checkboxes next to the headings or questions you want to include in your quiz</li>
    <li>The 'Max Questions' number at the top controls how many total question will be included in the quiz</li>
    <li>The 'Format' menu controls whether your quiz will display all questions at once on a continuous page, or cycle through them one at a time. </li>
  </ul>

  <div id='chooser'></div>

  <div id='questionsAll' style="margin-top:1.5cm; display:none;display:flex;flex-wrap:wrap;">
    <div id='wrapper-all' class='wrapper'></div>
    <div id='result-all' class='result' style="display:none;"></div>
  </div>

  <div id='questionCount' class='questionCounter' style="margin-top:0.5cm;display:none;"></div>
  <div id='questionsOne' class='wrapper questionContainer' style="margin-top:1.5cm; height:75%; display:none;">
    <div id='output-one' class='outputFixed'></div>
    <div id='inputWrapper-one' class='input'>
      <div id='caret-one' class='caret'>></div>
      <div id='input-one' class='inputField' contenteditable=true></div>
    </div>
    <div id='result-one' class='result' style="display:none;"></div>
  </div>


  <script>
    // Hide question areas until Make is clicked
    document.getElementById('questionsAll').style.display = 'none'
    document.getElementById('questionsOne').style.display = 'none'

    //
    const allTags = union(flatten(Object.keys(Question.Types).map(x=>x.split('-').slice(0,-1))));
    const allCats = union(flatten(Object.keys(Question.Types).map(x=>x.split('-').slice(0,1))));

    // settings from URL params
    var fullParams = new URLSearchParams(window.location.search);
    const cats =  fullParams.get('cat') || '';
    const tags = fullParams.get('tag') || ''
    // let view = fullParams.get('view') || 'all'
    let view = getSelectedOptionName("view");
    document.getElementById('view').value = view;

    toggleCounter = 0;


    function toggleView(filterPars) {
      var questionsTree;
      if (toggleCounter > 0) {
        clearQuestions(toggleCounter)
      }
      toggleCounter = toggleCounter + 1;
      addQuestionHolder(toggleCounter)
      questionsTree = {};
      view = getSelectedOptionName("view");
      if (fullParams.get('view') == 'saved') {
        loadStateFromLocalStorage(questionsTree)
        writePageFromQuestionTree(questionsTree,toggleCounter,true);
        makeEWS('current');
      }  else if (view == 'all') {
        loadAllQuestions(questionsTree,filterPars, toggleCounter);
        writePageFromQuestionTree(questionsTree,toggleCounter);
      } else if (view == 'presets') {
        // questionsGroups loaded in presets.js
        writePresets(questionsGroups, filterPars, toggleCounter)
      } else if (view=='kidA') {
        writePresets(questionsGroupsA, filterPars, toggleCounter,autolabel=false)
      } else if (view=='kidB') {
        writePresets(questionsGroupsB, filterPars, toggleCounter,autolabel=false)
      }
    }

    // start it up
    var filterPars = {'cats':cats,'tags':tags};
    toggleView(filterPars)



  </script>


</body>

</html>
